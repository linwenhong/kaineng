webpackJsonp([1],{"3fs2":function(t,e,r){var s=r("RY/4"),i=r("dSzd")("iterator"),a=r("/bQp");t.exports=r("FeBl").getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||a[s(t)]}},BO1k:function(t,e,r){t.exports={default:r("fxRn"),__esModule:!0}},"RY/4":function(t,e,r){var s=r("R9M2"),i=r("dSzd")("toStringTag"),a="Arguments"==s(function(){return arguments}());t.exports=function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),i))?r:a?s(e):"Object"==(n=s(e))&&"function"==typeof e.callee?"Arguments":n}},fxRn:function(t,e,r){r("+tPU"),r("zQR9"),t.exports=r("g8Ux")},g8Ux:function(t,e,r){var s=r("77Pl"),i=r("3fs2");t.exports=r("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},tWc3:function(t,e){},tdCf:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r("BO1k"),i=r.n(s),a={name:"ReplenishOrder",data:function(){return{user:this.$store.getters.getUser,deviceId:this.$route.query.device_id,tableOptions:[{key:"trade_no",title:"编号"},{key:"mch_name",title:"商户"},{key:"device_id",title:"设备sn"},{key:"device_name",title:"设备名"},{key:"order_status",title:"状态"},{key:"order_type",title:"下单方式"},{key:"create_at",title:"创建时间"}],items:[],DevicePassageways:[],Passageways:[],total:0,page:1,pageSize:this.$Config.page_size,condition:{order_status:3},selectOrder:{},validate:null,isSubmit:!1}},methods:{getDataTables:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r={mch_id:this.user.mch_id,device_id:this.deviceId,page_no:e,page_size:this.pageSize};for(var s in this.condition)this.condition[s]&&(r[s]=this.condition[s]);this.$Service.ReplenishOrder.get(r).then(function(e){e.err_code?toastr.error(e.err_msg,e.err_code):(t.items=e.list,t.total=e.total,t.$nextTick(function(){return t.$H5UI.iCheck()}))})},pageChange:function(t){this.getDataTables(t)},clear:function(){this.$H5UI.reset(this.validate),this.form={},this.isSubmit=!1,$("#file").val(""),$("#img").attr("src",""),$("#Modal").modal("hide")},add:function(){this.clear()},checkForm:function(t){return!0},submit:function(){var t=this;if(!this.isSubmit&&$("#form").valid()&&this.checkForm(this.form)){this.isSubmit=!0;var e={mch_id:this.selectOrder.mch_id,trade_no:this.selectOrder.trade_no,list:[]},r={mch_id:this.selectOrder.mch_id,trade_no:this.selectOrder.trade_no,list:[]};this.Passageways.map(function(t){var s={channel_no:t.channel_no,product_name:t.product_name,spec:t.spec,price:t.price,residue:t.residue,require_sum:t.require_sum||0};t.id?(s.id=t.id,e.list.push(s)):t.require_sum>0&&r.list.push(s)}),e.list.length>0&&this.$Service.ReplenishOrder.edit(e).then(function(e){t.isSubmit=!1,0==e.err_code?(toastr.success("修改成功"),t.getDataTables(t.page),$("#Modal").modal("hide")):toastr.error(e.err_msg,e.err_code)}),r.list.length>0&&this.$Service.ReplenishOrder.detailsAdd(r).then(function(t){0==t.err_code||toastr.error(t.err_msg,t.err_code)})}},edit:function(t){var e=this;this.clear(),this.selectOrder=t,this.Passageways=[],this.$Service.ReplenishOrder.details({mch_id:this.user.mch_id,trade_no:t.trade_no,page_no:1,page_size:1e4}).then(function(t){0==t.err_code?e.setPassageways(t.list||[]):toastr.error(t.err_msg,t.err_code)})},cancel:function(t){var e=this;this.$Service.ReplenishOrder.cancel({mch_id:this.user.mch_id,trade_no:t.trade_no}).then(function(t){0==t.err_code?(toastr.success("取消成功"),e.getDataTables()):toastr.error(t.err_msg,t.err_code)})},getDevicePassageways:function(){var t=this;this.$Service.GoodUpperShelf.get({mch_id:this.user.mch_id,device_id:this.deviceId,page_no:1,page_size:1e4}).then(function(e){e.err_code?toastr.error(e.err_msg,e.err_code):t.DevicePassageways=e.list})},setPassageways:function(t){this.Passageways=this.DevicePassageways.map(function(e){var r={channel_no:e.channel_no,product_name:e.product_name,spec:e.spec,price:e.product_price,residue:e.product_sum,require_sum:0},s=!0,a=!1,n=void 0;try{for(var o,c=i()(t);!(s=(o=c.next()).done);s=!0){var d=o.value;if(d.channel_no==e.channel_no){r.id=d.id,r.require_sum=d.require_sum;break}}}catch(t){a=!0,n=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw n}}return r})}},created:function(){this.getDevicePassageways(),this.getDataTables()},mounted:function(){this.validate=this.$H5UI.validate("#form")}},n={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wrapper wrapper-content"},[r("page-header-button",{on:{add:t.add}}),t._v(" "),r("div",{staticClass:"ibox float-e-margins"},[t._m(0),t._v(" "),r("div",{staticClass:"ibox-content"},[r("div",{staticClass:"search-page"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"control-label"},[t._v("商品分类")]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.condition.order_status,expression:"condition['order_status']"}],staticClass:"form-control",on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.condition,"order_status",e.target.multiple?r:r[0])}}},[r("option",{attrs:{value:"4"}},[t._v("全部")]),t._v(" "),r("option",{attrs:{value:"1"}},[t._v("未完成")]),t._v(" "),r("option",{attrs:{value:"2"}},[t._v("已完成")]),t._v(" "),r("option",{attrs:{value:"3"}},[t._v("已取消")])]),t._v(" "),r("button",{staticClass:"btn btn-primary search",attrs:{type:"button"},on:{click:function(e){t.getDataTables()}}},[t._v("查询")])])]),t._v(" "),r("table",{staticClass:"table table-bordered text-center"},[r("thead",[r("tr",[t._l(t.tableOptions,function(e){return r("th",[t._v(t._s(e.title))])}),t._v(" "),r("th",[t._v("操作")])],2)]),t._v(" "),r("tbody",t._l(t.items,function(e,s){return r("tr",{key:e.id},[r("td",[t._v(t._s(e.trade_no))]),t._v(" "),r("td",[t._v(t._s(e.mch_name))]),t._v(" "),r("td",[t._v(t._s(e.device_id))]),t._v(" "),r("td",[t._v(t._s(e.device_name))]),t._v(" "),r("td",[t._v(t._s(t._f("ReplenishOrderStatus")(e.order_status)))]),t._v(" "),r("td",[t._v(t._s(t._f("ReplenishOrderType")(e.order_type)))]),t._v(" "),r("td",[t._v(t._s(e.create_at))]),t._v(" "),r("td",[r("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button","data-toggle":"modal","data-target":"#Modal"},on:{click:function(r){t.edit(e)}}},[t._v("编辑")]),t._v(" "),1==e.order_status?[r("info-confirm",{attrs:{data:e,text:"取消",title:"确定要取消订单吗？"},on:{confirm:t.cancel}})]:t._e()],2)])}))]),t._v(" "),r("vue-pagination",{attrs:{"current-page":t.page,total:t.total,"page-size":t.pageSize,theme:"gray"},on:{"current-change":t.pageChange}})],1)]),t._v(" "),r("div",{staticClass:"modal inmodal fade",attrs:{id:"Modal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog modal-md"},[r("div",{staticClass:"modal-content"},[t._m(1),t._v(" "),r("form",{staticClass:"form-horizontal",attrs:{id:"form"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[r("div",{staticClass:"modal-body"},[r("table",{staticClass:"table table-bordered text-center"},[t._m(2),t._v(" "),r("tbody",t._l(t.Passageways,function(e,s){return r("tr",{key:e.id},[r("td",[t._v(t._s(e.channel_no))]),t._v(" "),r("td",[t._v(t._s(e.product_name))]),t._v(" "),r("td",[t._v(t._s(e.spec))]),t._v(" "),r("td",[t._v(t._s(e.residue))]),t._v(" "),r("td",{staticStyle:{width:"100px"}},[r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.require_sum,expression:"passageway.require_sum",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"text",maxlength:"4",oninput:"numberFormat(this)",name:"require_sum"},domProps:{value:e.require_sum},on:{input:function(r){r.target.composing||t.$set(e,"require_sum",t._n(r.target.value))},blur:function(e){t.$forceUpdate()}}})])])}))])]),t._v(" "),t._m(3)])])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ibox-title"},[e("h5",[this._v("设备补货订单管理")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")]),e("span",{staticClass:"sr-only"},[this._v("Close")])]),this._v(" "),e("h4",{staticClass:"modal-title"},[this._v("补货详情")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",[r("th",[t._v("货道号")]),t._v(" "),r("th",[t._v("商品")]),t._v(" "),r("th",[t._v("规格")]),t._v(" "),r("th",[t._v("原库存")]),t._v(" "),r("th",[t._v("要求补货数量")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-footer"},[e("b",{staticClass:"btn btn-white",attrs:{"data-dismiss":"modal"}},[this._v("关闭")]),this._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[this._v("提交")])])}]};var o=r("VU/8")(a,n,!1,function(t){r("tWc3")},"data-v-479c81dc",null);e.default=o.exports}});
webpackJsonp([1],{BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var i=s("77Pl"),a=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},kMXg:function(t,e){},tdCf:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("BO1k"),a=s.n(i),r={name:"ReplenishOrder",data:function(){return{user:this.$store.getters.getUser,deviceId:this.$route.query.device_id,tableOptions:[{key:"trade_no",title:"编号"},{key:"mch_name",title:"商户"},{key:"device_id",title:"设备sn"},{key:"device_name",title:"设备名"},{key:"order_status",title:"状态"},{key:"order_type",title:"下单方式"},{key:"create_at",title:"创建时间"}],items:[],DevicePassageways:[],Passageways:[],total:0,page:1,pageSize:this.$Config.page_size,condition:{order_status:4},selectOrder:{},validate:null,isSubmit:!1}},methods:{getDataTables:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s={mch_id:this.user.mch_id,device_id:this.deviceId,page_no:e,page_size:this.pageSize};for(var i in this.condition)this.condition[i]&&(s[i]=this.condition[i]);this.$Service.ReplenishOrder.get(s).then(function(e){e.err_code?toastr.error(e.err_msg,e.err_code):(t.items=e.list,t.total=e.total,t.$nextTick(function(){return t.$H5UI.iCheck()}))})},pageChange:function(t){this.getDataTables(t)},clear:function(){this.$H5UI.reset(this.validate),this.form={},this.isSubmit=!1,$("#file").val(""),$("#img").attr("src",""),$("#Modal").modal("hide")},add:function(){this.clear()},checkForm:function(t){return!0},submit:function(){var t=this;if(!this.isSubmit&&$("#form").valid()&&this.checkForm(this.form)){this.isSubmit=!0;var e={mch_id:this.selectOrder.mch_id,trade_no:this.selectOrder.trade_no,list:[]},s={mch_id:this.selectOrder.mch_id,trade_no:this.selectOrder.trade_no,list:[]};this.Passageways.map(function(t){var i={channel_no:t.channel_no,product_name:t.product_name,spec:t.spec,price:t.price,residue:t.residue,require_sum:t.require_sum||0};t.id?(i.id=t.id,e.list.push(i)):t.require_sum>0&&s.list.push(i)}),e.list.length>0&&this.$Service.ReplenishOrder.edit(e).then(function(e){t.isSubmit=!1,0==e.err_code?(toastr.success("修改成功"),t.getDataTables(t.page),$("#Modal").modal("hide")):toastr.error(e.err_msg,e.err_code)}),s.list.length>0&&this.$Service.ReplenishOrder.detailsAdd(s).then(function(t){0==t.err_code||toastr.error(t.err_msg,t.err_code)})}},edit:function(t){var e=this;this.clear(),this.selectOrder=t,this.Passageways=[],this.$Service.ReplenishOrder.details({mch_id:this.user.mch_id,trade_no:t.trade_no,page_no:1,page_size:1e4}).then(function(t){0==t.err_code?e.setPassageways(t.list||[]):toastr.error(t.err_msg,t.err_code)})},cancel:function(t){var e=this;this.$Service.ReplenishOrder.cancel({mch_id:this.user.mch_id,trade_no:t.trade_no}).then(function(t){0==t.err_code?(toastr.success("取消成功"),e.getDataTables()):toastr.error(t.err_msg,t.err_code)})},getDevicePassageways:function(){var t=this;this.$Service.GoodUpperShelf.get({mch_id:this.user.mch_id,device_id:this.deviceId,page_no:1,page_size:1e4}).then(function(e){e.err_code?toastr.error(e.err_msg,e.err_code):t.DevicePassageways=e.list})},setPassageways:function(t){this.Passageways=this.DevicePassageways.map(function(e){var s={channel_no:e.channel_no,product_name:e.product_name,spec:e.spec,price:e.product_price,residue:e.product_sum,require_sum:0},i=!0,r=!1,n=void 0;try{for(var o,c=a()(t);!(i=(o=c.next()).done);i=!0){var d=o.value;if(d.channel_no==e.channel_no){s.id=d.id,s.require_sum=d.require_sum;break}}}catch(t){r=!0,n=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw n}}return s})}},created:function(){this.getDevicePassageways(),this.getDataTables()},mounted:function(){this.validate=this.$H5UI.validate("#form")}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper wrapper-content"},[s("page-header-button",{on:{add:t.add}}),t._v(" "),s("div",{staticClass:"ibox float-e-margins"},[t._m(0),t._v(" "),s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"search-page"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label"},[t._v("商品分类")]),t._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:t.condition.order_status,expression:"condition['order_status']"}],staticClass:"form-control",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.condition,"order_status",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"4"}},[t._v("全部")]),t._v(" "),s("option",{attrs:{value:"1"}},[t._v("未完成")]),t._v(" "),s("option",{attrs:{value:"2"}},[t._v("已完成")]),t._v(" "),s("option",{attrs:{value:"3"}},[t._v("已取消")])]),t._v(" "),s("button",{staticClass:"btn btn-primary search",attrs:{type:"button"},on:{click:function(e){t.getDataTables()}}},[t._v("查询")])])]),t._v(" "),s("table",{staticClass:"table table-bordered text-center"},[s("thead",[s("tr",[t._l(t.tableOptions,function(e){return s("th",[t._v(t._s(e.title))])}),t._v(" "),s("th",[t._v("操作")])],2)]),t._v(" "),s("tbody",t._l(t.items,function(e,i){return s("tr",{key:e.id},[s("td",[t._v(t._s(e.trade_no))]),t._v(" "),s("td",[t._v(t._s(e.mch_name))]),t._v(" "),s("td",[t._v(t._s(e.device_id))]),t._v(" "),s("td",[t._v(t._s(e.device_name))]),t._v(" "),s("td",[t._v(t._s(t._f("ReplenishOrderStatus")(e.order_status)))]),t._v(" "),s("td",[t._v(t._s(t._f("ReplenishOrderType")(e.order_type)))]),t._v(" "),s("td",[t._v(t._s(e.create_at))]),t._v(" "),s("td",[s("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button","data-toggle":"modal","data-target":"#Modal"},on:{click:function(s){t.edit(e)}}},[t._v("编辑")]),t._v(" "),1==e.order_status?[s("info-confirm",{attrs:{data:e,text:"取消",title:"确定要取消订单吗？"},on:{confirm:t.cancel}})]:t._e()],2)])}))]),t._v(" "),s("vue-pagination",{attrs:{"current-page":t.page,total:t.total,"page-size":t.pageSize,theme:"gray"},on:{"current-change":t.pageChange}})],1)]),t._v(" "),s("div",{staticClass:"modal inmodal fade",attrs:{id:"Modal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog modal-md"},[s("div",{staticClass:"modal-content"},[t._m(1),t._v(" "),s("form",{staticClass:"form-horizontal",attrs:{id:"form"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[s("div",{staticClass:"modal-body"},[s("table",{staticClass:"table table-bordered text-center"},[t._m(2),t._v(" "),s("tbody",t._l(t.Passageways,function(e,i){return s("tr",{key:e.id},[s("td",[t._v(t._s(e.channel_no))]),t._v(" "),s("td",[t._v(t._s(e.product_name))]),t._v(" "),s("td",[t._v(t._s(e.spec))]),t._v(" "),s("td",[t._v(t._s(e.residue))]),t._v(" "),s("td",{staticStyle:{width:"100px"}},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:e.require_sum,expression:"passageway.require_sum",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"text",maxlength:"4",oninput:"numberFormat(this)",name:"require_sum"},domProps:{value:e.require_sum},on:{input:function(s){s.target.composing||t.$set(e,"require_sum",t._n(s.target.value))},blur:function(e){t.$forceUpdate()}}})])])}))])]),t._v(" "),t._m(3)])])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ibox-title"},[e("h5",[this._v("设备补货订单管理")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")]),e("span",{staticClass:"sr-only"},[this._v("Close")])]),this._v(" "),e("h4",{staticClass:"modal-title"},[this._v("补货详情")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",[t._v("货道号")]),t._v(" "),s("th",[t._v("商品")]),t._v(" "),s("th",[t._v("规格")]),t._v(" "),s("th",[t._v("原库存")]),t._v(" "),s("th",[t._v("要求补货数量")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-footer"},[e("b",{staticClass:"btn btn-white",attrs:{"data-dismiss":"modal"}},[this._v("关闭")]),this._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[this._v("提交")])])}]};var o=s("VU/8")(r,n,!1,function(t){s("kMXg")},"data-v-185b535a",null);e.default=o.exports}});